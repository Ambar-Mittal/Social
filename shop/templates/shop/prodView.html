{% extends 'shop/basic.html' %}

{% block title %} {{Vproduct.product_name}} {% endblock %}
{% block body %}
<section class="text-gray-600 body-font overflow-hidden">
    <div class="container px-5 py-24 mx-auto">
      <div class="lg:w-4/5 mx-auto flex flex-wrap">
        <img alt="ecommerce" class="lg:w-1/2 w-full lg:h-auto h-64 object-cover object-center rounded" src="/media/{{Vproduct.image}}">
        <div class="lg:w-1/2 w-full lg:pl-10 lg:py-6 mt-6 lg:mt-0">
          <h2 class="text-sm title-font text-gray-500 tracking-widest">BRAND NAME</h2>
          <h1 class="text-gray-900 text-3xl title-font font-medium mb-1" id="namepr{{Vproduct.id}}">{{Vproduct.product_name}}</h1>
          <div class="flex mb-4">
            <span class="flex items-center">
              <svg fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-indigo-500" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
              <svg fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-indigo-500" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
              <svg fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-indigo-500" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
              <svg fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-indigo-500" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
              <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 text-indigo-500" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
              </svg>
              <span class="text-gray-600 ml-3">4 Reviews</span>
            </span>
            
          </div>
          <p class="leading-relaxed">{{Vproduct.desc}}</p>
          <div class="flex mt-6 items-center pb-5 border-b-2 border-gray-100 mb-5">
            <div class="flex">
              <span class="mr-3">Color</span>
              <button class="border-2 border-gray-300 rounded-full w-6 h-6 focus:outline-none"></button>
              <button class="border-2 border-gray-300 ml-1 bg-gray-700 rounded-full w-6 h-6 focus:outline-none"></button>
              <button class="border-2 border-gray-300 ml-1 bg-indigo-500 rounded-full w-6 h-6 focus:outline-none"></button>
            </div>
            <div class="flex ml-6 items-center">
              <span class="mr-3">Size</span>
              <div class="relative">
                <select class="rounded border appearance-none border-gray-300 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 text-base pl-3 pr-10">
                  <option>SM</option>
                  <option>M</option>
                  <option>L</option>
                  <option>XL</option>
                </select>
                <span class="absolute right-0 top-0 h-full w-10 text-center text-gray-600 pointer-events-none flex items-center justify-center">
                  <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4" viewBox="0 0 24 24">
                    <path d="M6 9l6 6 6-6"></path>
                  </svg>
                </span>
              </div>
            </div>
          </div>
          <div class="flex">
            <p class="title-font font-medium text-2xl text-gray-900 mt-2" >M.R.P: â‚¹<span id="pricepr{{Vproduct.id}}">{{Vproduct.price}}</span></p>
            {% comment %} <span class="divpr flex ml-auto text-white bg-indigo-500 border-0 py-2 px-6 focus:outline-none hover:bg-indigo-600 rounded" id="divpr{{Vproduct.id}}"><button class=" cart" type="button" id="pr{{Vproduct.id}}">Add to Cart</button></span> {% endcomment %}
            <span id="divpr{{Vproduct.id}}" class="divpr w-auto">
              <button type="button" id="pr{{Vproduct.id}}" class="hidden lg:flex lg:mx-auto lg:flex lg:items-center lg:w-auto lg:space-x-6 md:flex md:mx-auto lg:ml-24 md:ml-1 basis-1/2 md:mr-12 md:flex md:items-center md:w-auto md:space-x-6 inline-flex items-center bg-sky-600 border-0 py-3  px-4 focus:outline-none hover:bg-cyan-500 rounded text-base md:mt-0 text-sm font-medium cart text-white">Add to Cart</button>
            </span><a href='/shop/checkout/'>
            <button class="lg:flex lg:mx-auto lg:flex lg:items-center lg:w-auto lg:space-x-6 md:flex md:mx-auto lg:ml-20 md:ml-1 basis-1/2 md:mr-12 md:flex md:items-center md:w-auto md:space-x-6 inline-flex items-center bg-sky-600 border-0 py-3 px-6 focus:outline-none hover:bg-cyan-500 rounded text-base md:mt-0 text-sm font-medium cart text-white" id='Buy'>Buy Now</button></a>
            
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block js %}
<script>

  // Find out the cart from localStorage
  console.log("working")
  if (localStorage.getItem('cart') == null) {
    console.log("idhar hu")
    var cart = {};
  }

  else {
    cart = JSON.parse(localStorage.getItem('cart'))
    console.log("idhar hu1:",cart)
    // updateCart(cart);
    console.log("idhar hu2")
  }

  // If the Add to Cart button is clicked, add the item


  $('.divpr').on('click', 'button.cart', function () {
    var idstr = this.id.toString();
    console.log("Kaise ho miya",idstr)
    if (cart[idstr] != undefined) {
      qty = cart[idstr][0] + 1;
    } else {
      qty = 1;
      name = document.getElementById('name' + idstr).innerHTML
      price = document.getElementById('price' + idstr).innerHTML
      console.log("price is",price)
      cart[idstr] = [qty, name, parseInt(price)];
    }
    updateCart(cart);
  });


  // Add popover to Cart
  $('#popcart').popover();
  updatePopover(cart);
  function updatePopover(cart) {
    console.log('We are inside updatePopover');
    var popStr = "";
    popStr = popStr + "<h5 class='text-center my-2'>Cart</h5><div class='mx-2 my-2'>";
    var i = 1;
    for (var item in cart) {
      popStr = popStr + "<b>" + i + "</b>. ";
      popStr = popStr + document.getElementById('name' + item).innerHTML.slice(0, 19) + "... Qty: " + cart[item][0] + '<br>';
      i = i + 1;
    }
    popStr = popStr + "</div> <a href='/shop/checkout/'><button class='inline-flex items-center bg-gray-100 border-0  py-1.5 px-3.5 focus:outline-none hover:bg-cyan-500 rounded text-base md:mt-0 text-sm ml-4 font-medium bg-sky-600 text-white mr-4' id='checkout'>Checkout</button></a> <button class='inline-flex items-center bg-gray-100 border-0 py-1.5 px-3.5 focus:outline-none hover:bg-cyan-500 rounded text-base md:mt-0 text-sm ml-4 font-medium bg-sky-600 text-white mr-4' id='clearCart' onclick='clearCart()' >Clear Cart</button> "
    console.log(popStr);
    document.getElementById('popcart').setAttribute('data-content', popStr);
    $('#popcart').popover('show');
  }

  // Function to Clear Cart
  function clearCart() {
    cart = JSON.parse(localStorage.getItem('cart'));
    for (var item in cart) {
      document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="hidden lg:flex lg:mx-auto lg:flex lg:items-center lg:w-auto lg:space-x-6 md:flex md:mx-auto lg:ml-24 md:ml-1 basis-1/2 md:mr-12 md:flex md:items-center md:w-auto md:space-x-6 inline-flex items-center bg-sky-600 border-0 py-3   px-4 focus:outline-none hover:bg-cyan-500 rounded text-base md:mt-0 text-sm font-medium cart text-white">Add to Cart</button>'
    }
    localStorage.clear();
    cart = {};
    updateCart(cart)
  }

  // Function to Update Cart
  function updateCart(cart) {
    var sum = 0
    for (var item in cart) {
      sum = sum + cart[item][0];
      console.log('item h',item)
      document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "' class='inline-flex items-center bg-gray-100 border-0 space-x-6 basis-1/2 space-x-6 py-3 px-4 focus:outline-none w-auto hover:bg-cyan-500 rounded text-base md:mt-0 text-sm ml-24 font-medium bg-sky-600 text-white minus'>-</button> <span id='val" + item + "' class='text-sm font-medium px-1.5'>" + cart[item][0] + "</span> <button id='plus" + item + "' class='inline-flex items-center bg-gray-100 border-0 basis-1/2  py-3 px-4 focus:outline-none w-auto hover:bg-cyan-500 rounded text-base md:mt-0 space-x-6 text-sm font-medium bg-sky-600 text-white plus'> + </button>";
    }
    console.log("This is cart",cart)
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('cart').innerHTML = sum;
    updatePopover(cart);
  }

  $('.divpr').on("click", "button.minus", function () {
    console.log('minus clicked');
    a = this.id.slice(7,);
    console.log(a)
    cart['pr' + a][0] = cart['pr' + a][0] - 1
    cart['pr' + a][0] = Math.max(0, cart['pr' + a][0])
    document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    updateCart(cart)
  });
  $('.divpr').on("click", "button.plus", function () {
    console.log("plus clicked")
    a = this.id.slice(6,);
    console.log
    cart['pr' + a][0] = cart['pr' + a][0] + 1;
    document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    updateCart(cart)
  });

  function Buynow(){

  }
</script>
{% endblock %}